"\nTask Manager for the Todo App.\n\nThis module provides the TaskManager class which handles all CRUD operations\nfor tasks in memory.\n"\nfrom typing import Dict, List, Optional\nfrom src.models.task import Task\nfrom src.services.storage_manager import StorageManager\n\n\nclass TaskManager:\n    "Manages tasks in memory with CRUD operations.\n\n    The TaskManager handles all operations related to tasks including\n    adding, retrieving, updating, deleting, and toggling completion status.\n    "\n\n    def __init__(self, storage_manager: StorageManager = None):\n        "Initialize the TaskManager with an empty task storage.\n\n        Args:\n            storage_manager: Optional StorageManager for persistence\n        "\n        self.storage_manager = storage_manager or StorageManager()\n\n        # Load existing tasks if available\n        self._tasks = self.storage_manager.load_tasks()\n\n        # Determine the next ID based on loaded tasks\n        if self._tasks:\n            self._next_id = max(self._tasks.keys()) + 1\n        else:\n            self._next_id = 1\n\n    def add_task(self, title: str, description: str = "") -> Task:\n        "Add a new task to the collection.\n\n        Args:\n            title: The title of the task\n            description: Optional description of the task\n\n        Returns:\n            The newly created Task object with a unique ID\n\n        Raises:\n            ValueError: If title is empty or invalid\n        "\n        if not title or not title.strip():\n            raise ValueError("Task title cannot be empty")\n\n        task_id = self._next_id\n        self._next_id += 1\n\n        task = Task(id=task_id, title=title.strip(), description=description.strip())\n        self._tasks[task_id] = task\n\n        # Save tasks to storage\n        self.storage_manager.save_tasks(self._tasks)\n\n        return task\n\n    def get_task_by_id(self, task_id: int) -> Optional[Task]:\n        "Retrieve a task by its ID.\n\n        Args:\n            task_id: The ID of the task to retrieve\n\n        Returns:\n            The Task object if found, None otherwise\n        "\n        return self._tasks.get(task_id)\n\n    def get_all_tasks(self) -> List[Task]:\n        "Retrieve all tasks in the collection.\n\n        Returns:\n            A list of all Task objects\n        "\n        return list(self._tasks.values())\n\n    def update_task(self, task_id: int, title: Optional[str] = None,\n                   description: Optional[str] = None) -> Optional[Task]:\n        "Update an existing task's title and/or description.\n\n        Args:\n            task_id: The ID of the task to update\n            title: New title for the task (optional)\n            description: New description for the task (optional)\n\n        Returns:\n            The updated Task object if successful, None if task doesn't exist\n        "\n        if task_id not in self._tasks:\n            return None\n\n        task = self._tasks[task_id]\n\n        if title is not None:\n            if not title.strip():\n                raise ValueError("Task title cannot be empty")\n            task.title = title.strip()\n\n        if description is not None:\n            task.description = description.strip()\n\n        # Save tasks to storage\n        self.storage_manager.save_tasks(self._tasks)\n\n        return task\n\n    def toggle_task_completion(self, task_id: int) -> Optional[Task]:\n        "Toggle the completion status of a task.\n\n        Args:\n            task_id: The ID of the task to toggle\n\n        Returns:\n            The updated Task object if successful, None if task doesn't exist\n        "\n        if task_id not in self._tasks:\n            return None\n\n        task = self._tasks[task_id]\n        task.completed = not task.completed\n\n        # Save tasks to storage\n        self.storage_manager.save_tasks(self._tasks)\n\n        return task\n\n    def delete_task(self, task_id: int) -> bool:\n        "Delete a task from the collection.\n\n        Args:\n            task_id: The ID of the task to delete\n\n        Returns:\n            True if the task was deleted, False if it didn't exist\n        "\n        if task_id not in self._tasks:\n            return False\n\n        del self._tasks[task_id]\n\n        # Save tasks to storage\n        self.storage_manager.save_tasks(self._tasks)\n\n        return True\n\n    def get_next_id(self) -> int:\n        "Get the next available task ID without incrementing the counter.\n\n        Returns:\n            The next available task ID\n        "\n        return self._next_id
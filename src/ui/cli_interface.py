"\nCLI Interface for the Todo App.\n\nThis module provides the CLIInterface class which handles user interaction\nthrough a console menu system.\n"\nfrom typing import Optional\nfrom src.services.task_manager import TaskManager\nfrom src.agent.todo_agent import TodoAgent\n\n\nclass CLIInterface:\n    "Handles user interaction through a console menu system.\n\n    The CLIInterface provides a user-friendly menu that allows users to\n    interact with the todo app using various options.\n    "\n\n    def __init__(self, task_manager: TaskManager, todo_agent: TodoAgent):\n        "Initialize the CLIInterface with TaskManager and TodoAgent.\n\n        Args:\n            task_manager: The TaskManager instance to interact with\n            todo_agent: The TodoAgent instance for natural language commands\n        "\n        self.task_manager = task_manager\n        self.todo_agent = todo_agent\n\n    def display_menu(self) -> None:\n        """Display the main menu options to the user."""\n        print("\n" + "="*50)\n        print("           TODO APP MENU")\n        print("="*50)\n        print("1. Add Task")\n        print("2. View All Tasks")\n        print("3. Mark Task Complete/Incomplete")\n        print("4. Update Task")\n        print("5. Delete Task")\n        print("6. Talk to AI Agent (Natural Language Mode)")\n        print("7. Exit")\n        print("="*50)\n\n    def get_user_choice(self) -> str:\n        "Get the user's menu choice.\n\n        Returns:\n            The user's choice as a string\n        "\n        try:\n            choice = input("Enter your choice (1-7): ").strip()\n            return choice\n        except (EOFError, KeyboardInterrupt):\n            print("\n\nExiting application...")\n            return "7"  # Return exit choice\n\n    def handle_add_task(self) -> None:\n        """Handle the add task option."""\n        print("\n--- Add New Task ---")\n        title = input("Enter task title: ").strip()\n\n        if not title:\n            print("Error: Task title cannot be empty.")\n            return\n\n        description = input("Enter task description (optional): ").strip()\n\n        try:\n            task = self.task_manager.add_task(title, description)\n            print(f"✓ Task added successfully with ID {task.id}")\n        except ValueError as e:\n            print(f"Error: {e}")\n\n    def handle_view_tasks(self) -> None:\n        """Handle the view tasks option."""\n        print("\n--- All Tasks ---")\n        tasks = self.task_manager.get_all_tasks()\n\n        if not tasks:\n            print("No tasks found.")\n            return\n\n        for task in tasks:\n            status = "✓" if task.completed else "○"\n            print(f"[{status}] ID: {task.id} | Title: {task.title}")\n            if task.description:\n                print(f"    Description: {task.description}")\n            print("-" * 40)\n\n    def handle_toggle_task(self) -> None:\n        """Handle the toggle task completion option."""\n        print("\n--- Mark Task Complete/Incomplete ---")\n\n        try:\n            task_id = int(input("Enter task ID: "))\n        except ValueError:\n            print("Error: Please enter a valid task ID (number).")\n            return\n\n        task = self.task_manager.toggle_task_completion(task_id)\n        if task:\n            status = "completed" if task.completed else "marked incomplete"\n            print(f"✓ Task {task_id} {status}.")\n        else:\n            print(f"✗ Task with ID {task_id} not found.")\n\n    def handle_update_task(self) -> None:\n        """Handle the update task option."""\n        print("\n--- Update Task ---")\n\n        try:\n            task_id = int(input("Enter task ID: "))\n        except ValueError:\n            print("Error: Please enter a valid task ID (number).")\n            return\n\n        # Check if task exists\n        task = self.task_manager.get_task_by_id(task_id)\n        if not task:\n            print(f"✗ Task with ID {task_id} not found.")\n            return\n\n        print(f"Current title: {task.title}")\n        if task.description:\n            print(f"Current description: {task.description}")\n\n        new_title = input("Enter new title (or press Enter to keep current): ").strip()\n        new_description = input("Enter new description (or press Enter to keep current): ").strip()\n\n        # Only update if new values were provided\n        update_title = new_title if new_title else None\n        update_description = new_description if new_description else None\n\n        updated_task = self.task_manager.update_task(\n            task_id,\n            title=update_title if update_title else None,\n            description=update_description if update_description else None\n        )\n\n        if updated_task:\n            print(f"✓ Task {task_id} updated successfully.")\n        else:\n            print(f"✗ Failed to update task {task_id}.")\n\n    def handle_delete_task(self) -> None:\n        """Handle the delete task option."""\n        print("\n--- Delete Task ---")\n\n        try:\n            task_id = int(input("Enter task ID: "))\n        except ValueError:\n            print("Error: Please enter a valid task ID (number).")\n            return\n\n        success = self.task_manager.delete_task(task_id)\n        if success:\n            print(f"✓ Task {task_id} deleted successfully.")\n        else:\n            print(f"✗ Task with ID {task_id} not found.")\n\n    def handle_natural_language_mode(self) -> None:\n        """Handle the natural language agent interaction."""\n        print("\n--- AI Agent Mode ---")\n        print("You can now interact with the AI agent using natural language.")\n        print("Examples: 'add Buy milk', 'list tasks', 'done 1', 'remove 2'")\n        print("Type 'exit' to return to the main menu.\n")\n\n        while True:\n            try:\n                command = input("AI Agent > ").strip()\n\n                if command.lower() in ['exit', 'quit', 'back']:\n                    break\n\n                if not command:\n                    print("Please enter a command or 'exit' to return to the main menu.")\n                    continue\n\n                response = self.todo_agent.execute_command(command)\n                print(response)\n\n            except (EOFError, KeyboardInterrupt):\n                print("\nReturning to main menu...")\n                break\n\n    def run(self) -> None:\n        """Run the main application loop."""\n        print("Welcome to the Todo App!")\n\n        while True:\n            self.display_menu()\n            choice = self.get_user_choice()\n\n            if choice == "1":\n                self.handle_add_task()\n            elif choice == "2":\n                self.handle_view_tasks()\n            elif choice == "3":\n                self.handle_toggle_task()\n            elif choice == "4":\n                self.handle_update_task()\n            elif choice == "5":\n                self.handle_delete_task()\n            elif choice == "6":\n                self.handle_natural_language_mode()\n            elif choice == "7":\n                print("\nThank you for using the Todo App. Goodbye!")\n                break\n            else:\n                print("\nInvalid choice. Please enter a number between 1 and 7.")\n\n            # Pause to let user see the result before showing menu again\n            if choice != "7":\n                input("\nPress Enter to continue...")